//#pragma GCC optimize("Ofast","unroll-loops")
#include <bits/stdc++.h>
//#define int long long
#define all(x) (x).begin(), (x).end()
#define rall(x) (x).rbegin(), (x).rend()

using namespace std;

const long long inf = 1e18, mod = 998244353;
const int k = 20;

vector<int> P;

int min_val(int x, int y) {
    auto get_min = [](int idxl, int idxr){
        int ans = P[idxl];
        for (int i = idxl + 1; i <= idxr; i++)
            ans = min(ans, P[i]);
        return ans;
    };
    int idxx = -1, idxy = -1;
    for (int i = 0; i < P.size(); i++) {
        if (P[i] == x)
            idxx = i;
        else if (P[i] == y)
            idxy = i;
    }
    if (idxx > idxy)
        swap(idxx, idxy);
    if ((idxy - idxx) * 2 < P.size())
        return get_min(idxx, idxy);
    else
        return min({get_min(0, idxx), get_min(idxy, P.size() - 1)});
}

struct ST {
    vector<vector<int>> t;
    vector<int> log;

    ST(vector<int> &pos) {
        int n = pos.size();
        t.resize(k, vector<int> (n));
        for (int i = 0; i < n; i++)
            t[0][pos[i]] = i;
        for (int i = 1; i < k; i++) {
            for (int j = 0; j + (1 << i) <= n; j++) {
                t[i][j] = min(t[i - 1][j], t[i - 1][j + (1 << (i - 1))]);
            }
        }

        log.resize(n + 1);
        for (int i = 2; i <= n; i++)
            log[i] = log[i / 2] + 1;
    }

    int get(int l, int r) {
        int sz = r - l;
        return min(t[log[sz]][l], t[log[sz]][r - (1 << log[sz])]);
    }
};

bool is_equal(vector<int> pos, vector<vector<int>> &quest) {
    int n = pos.size();
    ST st(pos);
    auto get_min = [&st, n](int l, int r){
        if (l > r)
            swap(l, r);
        if (r - l <= n / 2)
            return st.get(l, r + 1);
        return min(st.get(0, l + 1), st.get(r, n));
    };
    for (int a = 0; a < n; a++) {
        for (int b = a + 1; b < n; b++) {
            if (get_min(pos[a], pos[b]) != quest[a][b])
                return false;
        }
    }
    return true;
}

vector<int> solve(int n) {
    if (n == 1)
        return {1};
    vector<vector<int>> quest(n, vector<int> (n));
    for (int a = 0; a < n; a++) {
        quest[a][a] = a;
        for (int b = a + 1; b < n; b++) {
            quest[a][b] = min_val(a + 1, b + 1) - 1;
            quest[b][a] = min_val(a + 1 ,b + 1) - 1;
        }
    }
    vector<int> dist_to1(n), pos(n);
    vector<pair<int, int>> A(n, {0, 0});
    for (int a = 1; a < n; a++) {
        int dist = n / 2 + 1;
        for (int b = 0; b < n; b++) {
            if (quest[a][b] == 0)
                dist--;
        }
        dist_to1[a] = dist;
        A[a] = {dist, a};
    }
    sort(all(A));
    pos[A[1].second] = 1;
    pos[A[2].second] = n - 1;
    int positive = A[1].second;
    for (int i = 3; i < n - 2; i++) {
        if (quest[positive][A[i].second] != 0)
            pos[A[i].second] = A[i].first;
        else
            pos[A[i].second] = n - A[i].first;
    }
    auto last1 = A[n - 2], last2 = A[n - 1];
    pos[last1.second] = last1.first, pos[last2.second] = last2.first + 1;
    if (!is_equal(pos, quest)) {
        swap(last1, last2);
        pos[last1.second] = last1.first, pos[last2.second] = last2.first + 1;
    }
    vector<int> Q(n);
    for (int i = 0; i < n; i++)
        Q[pos[i]] = i + 1;
    return Q;
}

int min_val2(int x, int y, vector<int> A) {
    auto get_min = [&A](int idxl, int idxr){
        int ans = A[idxl];
        for (int i = idxl + 1; i <= idxr; i++)
            ans = min(ans, A[i]);
        return ans;
    };
    int idxx = -1, idxy = -1;
    for (int i = 0; i < A.size(); i++) {
        if (A[i] == x)
            idxx = i;
        else if (A[i] == y)
            idxy = i;
    }
    if (idxx > idxy)
        swap(idxx, idxy);
    if ((idxy - idxx) * 2 < A.size())
        return get_min(idxx, idxy);
    else
        return min({get_min(0, idxx), get_min(idxy, A.size() - 1)});
}

bool is_ok(vector<int> &A1, vector<int> &A2) {
    for (int a = 1; a <= A1.size(); a++) {
        for (int b = a + 1; b <= A2.size(); b++) {
            if (min_val2(a, b, A1) != min_val2(a, b, A2))
                return false;
        }
    }
    return true;
}

signed main() {
    ios_base::sync_with_stdio(false);
    cin.tie(nullptr);
    int n;
    cin >> n;
    P.resize(n);
    for (int i = 0; i < n; i++)
        cin >> P[i];

    vector<int> Q = solve(n);
    for (int i : Q)
        cout << i << ' ';
    cout << '\n';
    cout << is_ok(P, Q);
}